---
layout: post
title: VM웨어로 3-tier 구성하기
subtitle: A awesome static site generator.
author: 박지수
categories: SeSAC
---

## 1. 3-tier란 무엇인가  
3-tier란 클라이언트, 서버, 데이터베이스로 이루어진 3계층 구조를 가르킨다.
![3-tier 이미지](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/3-tier.png)  
어플리케이션이나 웹 페이지를 사용할 때, 사용자는 핸드폰, 컴퓨터 등을 사용하여 해당 기능을 사용한다. 이 부분에서 사용자가 볼 수 있는 웹페이지, 혹은 UI가 동작하는 부분을 **클라이언트**라 칭한다.  
클라이언트단이 사용자의 눈에 보이는 동작을 한다면, 그 뒤의 기능을 처리하는 부분은 **서버**이다. 서버에서 클라이언트의 요구(로그인, 검색, 장바구니 추가 등)가 이루어진다 볼 수 있다.  
이런 서버단에서의 동작은 **데이터베이스**에 저장된 정보들을 기반으로 하며, 서버에서 처리된 동작을 통해 데이터베이스의 정보가 업데이트 된다.
이런 식으로 동작하는 서버가 3개로 나뉜 구조를 3 tier라 부른다.  
<br/>

3 tier로 이루어진 검색엔진을 사용한다 가정 해 보자.   

##### 클라이언트  
![검색이미지](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/구글검색이미지.jpg)  
위와 같이 우리는 화면에 보이는 UI를 통해 찾고자 하는 검색어를 입력하고, 또 검색 결과를 확인할 수 있다. 이처럼 사용자와 직접 상호작용 하는 부분을 **클라이언트**, 혹은 **프론트엔드**라 부른다.    
<br/>

##### 서버  
![사서](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/사서.jpg)  
도서관에서 책을 빌리기 위해서는 책이 어느 구역에 있는지 찾고, 해당 구역에서 책을 뽑아야 한다. **서버**는 이처럼 사용자의 요청에 맞추어 다른 컴퓨터(도서관 책장)에 접근하여 데이터(책)를 가져오는 등의 기능을 수행한다.  
즉, 서버는 클라이언트의 요청에 응답하여 데이터 및 다른 컴퓨터에 접근하는 등의 기능을 제공한다.  
검색 엔진에 대입해 생각 해 보자면 **서버**는 검색 필터링에 맞게 검색 결과를 데이터베이스에 요청하고, 사용자의 관심사에 맞게 검색 결과를 정렬하는 등의 작업을 수행한다. **서버**는 이처럼 사용자가 직접 볼 필요가 없는 부분의 동작을 수행한다.  
<br/>

##### 데이터베이스    
**데이터베이스**에서는 우리가 웹/앱 등을 사용할 때 필요한 정보들이 저장된 곳이다. 데이터의 접근, 저장, 추가, 수정, 삭제 등의 작업이 수행된다. 서버에서 데이터베이스에 데이터를 요청하면 데이터베이스는 해당 데이터를 찾아 서버에 반환한다.  
데이터베이스는 다양한 정보를 가질 수 있다. 회원이 있는 웹/앱이라면 회원에 대한 정보가 필수적으로 들어갈 것이고, 검색엔진이라면 다른 웹페이지 링크가, 쇼핑몰이라면 상품의 정보가 들어있을 것이다.  
  
<br/>

위에 든 예시 외에도 실제 다양한 웹/앱에서 3-tier구조를 사용한다. 이제부터 실제 3-tier를 구성하며 그 동작 원리를 이해 해 보자.  

<br/><br/>

## 2. 3-tier 구성하기
![3tier실습](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/3tier구현.png)  
클라이언트, 서버, 데이터베이스로 구성된 3계층을 구현하기 위해서는 3개의 서버가 필요하다. 실제로 세 대의 컴퓨터를 돌리는 것은 어려우니 가상머신을 활용해 실습을 진행 해 보자.  
각각의 서버를 생성한 후 Nginx, Tomcat, MySQL을 사용해 구동하고, 연결하여 동작을 확인하자. 

##### 0. 서버 생성  
[리눅스-시작하기](https://jisoo449.github.io/Byte-Jisoo/sesac/2023/11/10/리눅스-시작하기.html#h-23-가상-서버-생성)를 참고하여 세 개의 서버를 생성하라.  
![테스트 서버 사진](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/가상머신3tier서버.png)  
<br/>

##### 1. 클라이언트 서버 설치  
앞서 설명했듯이 클라이언트 서버는 Nginx를 사용해 구동 할 것이다. `apt-get install` 명령어를 사용해 nginx를 설치하라.  
```Shell
$ sudo apt-get update
$ sudo apt-get install nginx
```  
<br/>

##### 2. tomcat 서버 설치  
백엔드 서버는 tomcat을 사용해 구동할 것이므로 `apt install`명령어를 사용해 tomcat을 설치하라. 여기서는 tomcat10을 설치하였다. 사용하는 우분투 서버의 버전에 따라 지원하는 tomcat 버전이 다르므로 이를 유념해야 한다.
```Shell
$ sudo apt update
$ sudo apt install tomcat10
```  
<br/>

##### 3. MySQL 설치  
MySql을 사용해 DBMS를 생성 할 것이다. mysql-server를 설치하라.
```Shell
$ sudo apt update
$ sudo apt install mysql-server
```  
<br/>

##### 4. 각 서버의 IP 확인  
클라이언트-서버, 서버-DB를 연결하기 위해서는 각 서버의 IP주소를 알아야 한다.  
아래의 명령어를 입력하여 IP주소를 확인할 수 있다.
```Shell
$ ip addr
```
위와 같이 명령어를 입력하면 여러 글자가 나올 것이다. 그 중 `ens`로 시작하는 단락의 inet 주소가 해당 서버의 ip주소이다.  
![우분퉁 ip주소](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/ip주소.png)  
<br/>

##### 5. Nginx 실행하여 웹서버 동작 확인  
```Shell
$ sudo systemctl start nginx
$ sudo systemctl status nginx
```
`start nginx` 명령어를 사용하여 nginx 서버를 켠 후 `systemctl status`명령어를 사용해 서비스의 상태를 확인하면 다음과 같은 화면을 볼 수 있다.  
![Nginx 실행 확인](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/nginx실행확인.png)  
State가 Running인 것으로 보아 nginx가 성공적으로 실행된 것을 확인할 수 있다.  
올라간 웹서버를 브라우저를 통해 접속하면 다음과 같은 화면을 확인할 수 있다.  
![Nginx 브라우저](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/nginx브라우저.png)  
<br/>

##### 6. Tomcat 실행하여 tomcat 동작 확인  
```Shell
$ sudo systemctl tomcat10 start
$ sudo systemctl status tomcat10
```  
`tomcat8 start` 명령어를 사용하여 설치한 버전의 tomcat 서버를 켠 후 `systemctl status`명령어를 사용해 서비스의 상태를 확인하면 다음과 같은 화면을 볼 수 있다.  
![Tomcat 실행 확인](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/tomcat실행확인.png)  
State가 Running인 것으로 보아 nginx가 성공적으로 실행된 것을 확인할 수 있다.  
올라간 웹서버를 브라우저를 통해 접속하면 다음과 같은 화면을 확인할 수 있다. 
![Tomcat 브라우저](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/tomcat브라우저.png)  
<br/>

##### 7. Nginx-tomcat 연동
Nginx에 tomcat 서버를 성공적으로 연결하면 이전에 보았던 ***Welcome to Nginx** 화면 대신 tomcat을 실행했을 때 나오는 화면이 나타날 것이다.    
이를 위해서는 Nginx의 설정 파일을 수정해야 한다.
Nginx의 설정 파일은 `/etc/nginx/sites-available/default`이다. 해당 파일을 수정하여 거칠 프록시 패스를 설정 해 주자.  
![Nginx 설정파일](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/nginx설정파일.png)  
`http://` 다음에 있는 IP 주소는 [4.각 서버의 IP 확인] 부분에서 확인한 tomcat의 IP 주소를 넣어주면 된다.  
위처럼 프록시 패스를 설정해준 후 nginx를 재시작하면 **Welcome to Nginx** 대신 tomcat의 브라우저 화면이 나올 것이다.
```Shell
$ sudo systemctl restart nginx
```
![nginx-tomcat이 연동된 브라우저 화면](https://jisoo449.github.io/Byte-Jisoo/assets/images/post/nginx-tomcat연동.png)  
<br/>



